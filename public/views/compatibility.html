
<img src="/assets/img/spinner.gif" class="spinner"/>

<div id="compatibility">


	<table ng-cloak ng-if="compatibilities !== null" id="compatibilities" class="table table-bordered" style="font-size: 0.8em" >
		<thead>
			<tr>
				<td colspan="2" rowspan="2" border="0"></td>
				<td ng-if="!$last" ng-repeat="parameter in parameters"
					colspan="{{ parameter.attributes.length}}">{{ parameter.name }}</td>
			</tr>
			<tr>
				<!-- render all attributes that exist -->
				<td ng-if="$index < getOffsets()[getOffsets().length-2]"
					ng-repeat="attribute in getAllAttributes()"
					data-attrid="{{attribute.id}}"
					ng-class="{ 'highlight': attribute.id == hoverX }"
				>
					{{Â attribute.name }}
				</td>
			</tr>
		</thead>
		<tbody>
			<!-- skip first parameter here -->

			<tr ng-repeat="y in getAllAttributes()" ng-if="$index >= getOffsets()[1]" >
			
				<!-- only show this td if the $index is a "new" parameter -->
				<td ng-if="getOffsets().indexOf($index) >= 0"
					rowspan="{{ getParameterByAttribute(y.id).attributes.length }}">
					{{ getParameterByAttribute(y.id).name }}
				</td>

				<td 
					ng-class="{ 'highlight': y.id == hoverY }"
					class="warning">{{ y.name}}</td>
				
				<td
					ng-init="paramX = getParameterByAttribute(x.id);
							paramY = getParameterByAttribute(y.id);
							compatibility = getCompatibilityRating(x.id, y.id);
							redundant = paramX.id >= paramY.id"
					ng-if="$index < getOffsets()[getOffsets().length - 2]"
					ng-class="{
								'success': compatibility.rating.value === 9,
								'warning': compatibility.rating.value === 4,
								'danger': compatibility.rating.value === 1,
								'disabled' : redundant
							}"
					ng-repeat="x in getAllAttributes()"
					ng-mouseenter="hover(x.id, y.id); hovered=true;"	
					ng-mouseleave="hover(0,0); hovered=false"
					>

					<!-- redundant means that this combination of attributes WILL be rendered in the following rows -->
					<div
						tooltip
						data-toggle="tooltip"
						data-placement="top"
						data-html="true"
						title="{{ paramX.name }}: {{ x.name }}<br/>{{ paramY.name }} : {{ y.name }}"
						ng-init="rating=false"
						ng-click="rating=true"
						ng-if="!redundant">

						<div ng-show="rating == false">
							{{ compatibility.rating.name }}
						</div>

						<div ng-show="rating == true" class="adding-compatibility">

							<input type="hidden"
									ng-model="compatibility.attr1"
									ng-init="compatibility.attr1 = x">
							<input type="hidden"
									ng-model="compatibility.attr2"
									ng-init="compatibility.attr2 = y">
							<input type="hidden"
									ng-model="compatibility.id"
									ng-init="compatibility.id = compatibility.id"/>
									
							<select ng-change="addCompatibility(compatibility); rating=false;"
									ng-model="compatibility.rating"
									ng-options="rating.name for rating in ratings">
								<option value="">Rate</option>
							</select>
						</div>
					</div>
				</td>
			</tr>

		</tbody>
	</table>

</div>